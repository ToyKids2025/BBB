<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Teste Sistema Remarketing FOMO - Recupera 50% das Vendas!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }

        .card h3 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        .test-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        .test-button:active {
            transform: scale(0.98);
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .metric {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #764ba2;
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .timeline-item.active {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            transform: translateX(10px);
        }

        .timeline-item.completed {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }

        .timeline-icon {
            font-size: 1.5em;
            margin-right: 15px;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-time {
            font-size: 0.85em;
            color: #666;
        }

        .notification-preview {
            background: #f8f9fa;
            border: 2px solid #764ba2;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .notification-header {
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 10px;
        }

        .notification-body {
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .whatsapp-preview {
            background: #e5ddd5;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
        }

        .whatsapp-message {
            background: white;
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #764ba2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-badge.active {
            background: #28a745;
            color: white;
        }

        .status-badge.pending {
            background: #ffc107;
            color: #333;
        }

        .status-badge.error {
            background: #dc3545;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Sistema de Remarketing FOMO</h1>
            <p>Recupera 30-50% das vendas perdidas com gatilhos psicol√≥gicos!</p>
        </div>

        <div class="dashboard">
            <!-- Simulador de Click -->
            <div class="card">
                <h3>üõçÔ∏è Simulador de Click sem Convers√£o</h3>
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value" id="clicks-tracked">0</div>
                        <div class="metric-label">Clicks Rastreados</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="pending-conversions">0</div>
                        <div class="metric-label">Aguardando Convers√£o</div>
                    </div>
                </div>

                <input type="text" id="product-url" placeholder="URL do produto Amazon/ML" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #ddd;">

                <button class="test-button" onclick="simularClick()">
                    üõí Simular Click no Link
                </button>
                <button class="test-button" onclick="simularAbandonoCarrinho()">
                    üõí Simular Abandono de Carrinho
                </button>
                <button class="test-button" onclick="simularMultiplosClicks()">
                    üë• Simular 10 Clicks
                </button>

                <div id="click-result" class="result"></div>
            </div>

            <!-- Timeline de Notifica√ß√µes -->
            <div class="card">
                <h3>‚è∞ Timeline de Notifica√ß√µes FOMO</h3>
                <div class="timeline" id="timeline">
                    <div class="timeline-item" data-time="6">
                        <span class="timeline-icon">üî•</span>
                        <div class="timeline-content">
                            <strong>6 horas - Escassez</strong>
                            <div class="timeline-time">S√≥ restam 5 unidades!</div>
                        </div>
                        <span class="status-badge pending">Aguardando</span>
                    </div>
                    <div class="timeline-item" data-time="12">
                        <span class="timeline-icon">üë•</span>
                        <div class="timeline-content">
                            <strong>12 horas - Prova Social</strong>
                            <div class="timeline-time">231 pessoas viram hoje</div>
                        </div>
                        <span class="status-badge pending">Aguardando</span>
                    </div>
                    <div class="timeline-item" data-time="20">
                        <span class="timeline-icon">üí∞</span>
                        <div class="timeline-content">
                            <strong>20 horas - Desconto</strong>
                            <div class="timeline-time">R$50 OFF exclusivo</div>
                        </div>
                        <span class="status-badge pending">Aguardando</span>
                    </div>
                    <div class="timeline-item" data-time="23">
                        <span class="timeline-icon">üö®</span>
                        <div class="timeline-content">
                            <strong>23 horas - √öltima Chance</strong>
                            <div class="timeline-time">Expira em 1 hora!</div>
                        </div>
                        <span class="status-badge pending">Aguardando</span>
                    </div>
                </div>

                <button class="test-button" onclick="acelararTempo()">
                    ‚ö° Acelerar Tempo (1h = 1s)
                </button>
                <button class="test-button" onclick="dispararProximaNotificacao()">
                    üì® Disparar Pr√≥xima
                </button>
            </div>

            <!-- Preview de Mensagens -->
            <div class="card">
                <h3>üì± Preview das Mensagens FOMO</h3>

                <select id="message-type" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px;">
                    <option value="scarcity">üî• Escassez</option>
                    <option value="social_proof">üë• Prova Social</option>
                    <option value="discount">üí∞ Desconto</option>
                    <option value="final_warning">üö® √öltima Chance</option>
                    <option value="cart_reminder">üõí Carrinho Abandonado</option>
                </select>

                <button class="test-button" onclick="previewMessage()">
                    üëÅÔ∏è Visualizar Mensagem
                </button>
                <button class="test-button" onclick="enviarTesteWhatsApp()">
                    üì± Teste WhatsApp
                </button>
                <button class="test-button" onclick="enviarTestePush()">
                    üîî Teste Push
                </button>

                <div id="message-preview"></div>
            </div>

            <!-- Performance Metrics -->
            <div class="card">
                <h3>üìä M√©tricas de Performance</h3>
                <div class="metric-grid">
                    <div class="metric">
                        <div class="metric-value" id="messages-sent">0</div>
                        <div class="metric-label">Mensagens Enviadas</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="messages-opened">0</div>
                        <div class="metric-label">Mensagens Abertas</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="conversions">0</div>
                        <div class="metric-label">Convers√µes</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="conversion-rate">0%</div>
                        <div class="metric-label">Taxa de Convers√£o</div>
                    </div>
                </div>

                <button class="test-button" onclick="simularConversao()">
                    üí∞ Simular Convers√£o
                </button>
                <button class="test-button" onclick="gerarRelatorio()">
                    üìà Gerar Relat√≥rio
                </button>

                <div id="metrics-result" class="result"></div>
            </div>

            <!-- A/B Testing -->
            <div class="card">
                <h3>üî¨ A/B Testing de Templates</h3>

                <button class="test-button" onclick="iniciarTesteAB()">
                    üöÄ Iniciar Teste A/B
                </button>
                <button class="test-button" onclick="verResultadosAB()">
                    üìä Ver Resultados
                </button>
                <button class="test-button" onclick="determinarVencedor()">
                    üèÜ Determinar Vencedor
                </button>

                <div id="ab-results" class="result"></div>
            </div>

            <!-- Configura√ß√µes -->
            <div class="card">
                <h3>‚öôÔ∏è Configura√ß√µes e Testes</h3>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 5px;">üì± WhatsApp (opcional):</label>
                    <input type="tel" id="whatsapp-number" placeholder="5511999999999" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                </div>

                <div style="margin: 15px 0;">
                    <label style="display: block; margin-bottom: 5px;">üìß Email (opcional):</label>
                    <input type="email" id="user-email" placeholder="seu@email.com" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                </div>

                <button class="test-button" onclick="salvarConfiguracoes()">
                    üíæ Salvar Configura√ß√µes
                </button>
                <button class="test-button" onclick="testarIntegracao()">
                    üîå Testar Integra√ß√£o
                </button>
                <button class="test-button" onclick="limparDados()">
                    üóëÔ∏è Limpar Dados
                </button>

                <div id="config-result" class="result"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Estado global do teste
        let clicksTracked = 0;
        let pendingConversions = [];
        let messagesSent = 0;
        let messagesOpened = 0;
        let conversions = 0;
        let activeTimers = [];
        let acceleratedTime = false;

        // Inicializar
        window.addEventListener('load', () => {
            updateMetrics();
            loadSavedConfig();
        });

        // Simular click sem convers√£o
        window.simularClick = function() {
            const url = document.getElementById('product-url').value ||
                       'https://www.amazon.com.br/dp/B08N5WRWNW';

            const clickData = {
                id: 'click_' + Date.now(),
                url: url,
                platform: detectPlatform(url),
                productName: extractProductName(url),
                clickTime: Date.now(),
                converted: false
            };

            pendingConversions.push(clickData);
            clicksTracked++;

            // Iniciar timeline de notifica√ß√µes
            startNotificationTimeline(clickData);

            const result = document.getElementById('click-result');
            result.className = 'result success';
            result.textContent = `‚úÖ Click rastreado com sucesso!

ID: ${clickData.id}
Produto: ${clickData.productName}
Platform: ${clickData.platform}
Status: Aguardando convers√£o

üì® Notifica√ß√µes agendadas:
‚Ä¢ 6h - Escassez
‚Ä¢ 12h - Prova Social
‚Ä¢ 20h - Desconto
‚Ä¢ 23h - √öltima Chance`;

            updateMetrics();
        };

        // Simular abandono de carrinho
        window.simularAbandonoCarrinho = function() {
            const clickData = {
                id: 'cart_' + Date.now(),
                url: 'https://www.mercadolivre.com.br/produto-teste',
                platform: 'mercadolivre',
                productName: 'Produto no Carrinho',
                clickTime: Date.now(),
                inCart: true,
                converted: false
            };

            pendingConversions.push(clickData);
            clicksTracked++;

            const result = document.getElementById('click-result');
            result.className = 'result warning';
            result.textContent = `üõí Carrinho abandonado detectado!

Produto: ${clickData.productName}
Valor estimado: R$ 299,90

üì® Remarketing de carrinho ativado
Primeira notifica√ß√£o em 2 horas`;

            updateMetrics();
        };

        // Simular m√∫ltiplos clicks
        window.simularMultiplosClicks = function() {
            for (let i = 0; i < 10; i++) {
                const platforms = ['amazon', 'mercadolivre', 'magazine'];
                const platform = platforms[Math.floor(Math.random() * platforms.length)];

                const clickData = {
                    id: 'batch_' + Date.now() + '_' + i,
                    url: `https://www.${platform}.com.br/produto-${i}`,
                    platform: platform,
                    productName: `Produto ${i + 1}`,
                    clickTime: Date.now() - (Math.random() * 3600000),
                    converted: false
                };

                pendingConversions.push(clickData);
                clicksTracked++;
            }

            const result = document.getElementById('click-result');
            result.className = 'result success';
            result.textContent = `‚úÖ 10 clicks simulados!

Distribui√ß√£o:
‚Ä¢ Amazon: ${pendingConversions.filter(c => c.platform === 'amazon').length}
‚Ä¢ Mercado Livre: ${pendingConversions.filter(c => c.platform === 'mercadolivre').length}
‚Ä¢ Magazine: ${pendingConversions.filter(c => c.platform === 'magazine').length}

Total pendente: ${pendingConversions.length} convers√µes`;

            updateMetrics();
        };

        // Timeline de notifica√ß√µes
        function startNotificationTimeline(clickData) {
            const times = [6, 12, 20, 23];
            const timelineItems = document.querySelectorAll('.timeline-item');

            times.forEach((hours, index) => {
                const delay = acceleratedTime ? hours * 1000 : hours * 3600000;

                const timer = setTimeout(() => {
                    // Atualizar UI
                    timelineItems[index].classList.add('active');
                    timelineItems[index].querySelector('.status-badge').textContent = 'Enviando...';
                    timelineItems[index].querySelector('.status-badge').className = 'status-badge active';

                    // Simular envio
                    messagesSent++;
                    updateMetrics();

                    setTimeout(() => {
                        timelineItems[index].classList.remove('active');
                        timelineItems[index].classList.add('completed');
                        timelineItems[index].querySelector('.status-badge').textContent = 'Enviado ‚úì';
                    }, 1000);
                }, delay);

                activeTimers.push(timer);
            });
        }

        // Acelerar tempo
        window.acelararTempo = function() {
            acceleratedTime = !acceleratedTime;
            const result = document.getElementById('click-result');
            result.className = 'result info';
            result.textContent = acceleratedTime
                ? '‚ö° Tempo acelerado! 1 hora = 1 segundo'
                : '‚è∞ Tempo normal restaurado';
        };

        // Disparar pr√≥xima notifica√ß√£o
        window.dispararProximaNotificacao = function() {
            const pending = document.querySelector('.timeline-item:not(.completed)');
            if (pending) {
                pending.classList.add('active');
                pending.querySelector('.status-badge').textContent = 'Enviando...';
                pending.querySelector('.status-badge').className = 'status-badge active';

                messagesSent++;
                updateMetrics();

                setTimeout(() => {
                    pending.classList.remove('active');
                    pending.classList.add('completed');
                    pending.querySelector('.status-badge').textContent = 'Enviado ‚úì';
                }, 1000);
            }
        };

        // Preview de mensagem
        window.previewMessage = function() {
            const type = document.getElementById('message-type').value;
            const preview = document.getElementById('message-preview');

            const templates = {
                scarcity: {
                    whatsapp: `üî• *ATEN√á√ÉO - ESTOQUE BAIXO*

Oi! Vi que voc√™ estava interessado no Produto XYZ.

‚ö†Ô∏è *ALERTA: S√≥ restam 7 unidades!*
üìä 89 pessoas viram isso hoje

_N√£o queria que voc√™ perdesse..._

üëâ bit.ly/seu-link

*V√°lido apenas hoje*`,
                    push: '‚ö†Ô∏è S√≥ 7 unidades restantes do produto que voc√™ viu!'
                },
                social_proof: {
                    whatsapp: `üò± *T√Å TODO MUNDO COMPRANDO!*

Alexandre,

O Produto XYZ est√° VOANDO!

üìà *Dados em tempo real:*
‚Ä¢ 31 compraram nas √∫ltimas 3h
‚Ä¢ 124 t√™m no carrinho agora
‚Ä¢ Avalia√ß√£o: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (4.8)

üéÅ *Cupom exclusivo: VOLTA10*

üëâ bit.ly/seu-link

_PS: 18 pessoas est√£o vendo agora_`,
                    push: 'üë• 31 pessoas compraram o produto que voc√™ viu!'
                },
                discount: {
                    whatsapp: `üí∏ *DESCONTO EXCLUSIVO PRA VOC√ä*

Alexandre, consegui algo especial!

üéÅ *Oferta Rel√¢mpago:*
‚ùå De: ~R$ 299,90~
‚úÖ Por: *R$ 199,90*
üí∞ Economia: R$ 100,00

‚è∞ *V√°lido por: 4h23min*

üì¶ + Frete Gr√°tis
üîÑ + Parcelamento s/ juros

üëâ bit.ly/seu-link`,
                    push: 'üí∞ R$ 100 de DESCONTO no produto que voc√™ viu!'
                },
                final_warning: {
                    whatsapp: `üö® *URGENTE - 1 HORA RESTANTE*

Alexandre, √© S√âRIO!

‚è∞ *O link expira em 1 HORA*

Depois disso:
‚ùå Pre√ßo volta para R$ 299,90
‚ùå Frete pago
‚ùå Sem parcelamento

‚úÖ *Garantir agora:* bit.ly/seu-link

‚ö†Ô∏è N√£o vai ter segunda chance!

_3 pessoas compraram enquanto voc√™ lia isso_`,
                    push: 'üö® EXPIRA EM 1 HORA! √öltima chance!'
                },
                cart_reminder: {
                    whatsapp: `üõí *VOC√ä ESQUECEU ISSO NO CARRINHO*

Alexandre,

O Produto XYZ ainda est√° te esperando!

üí° *Complete agora e ganhe:*
‚Ä¢ Frete gr√°tis
‚Ä¢ 5% de desconto extra
‚Ä¢ Brindes surpresa

üëâ bit.ly/seu-link

_Reservamos por mais 2 horas_`,
                    push: 'üõí Voc√™ esqueceu um item no carrinho!'
                }
            };

            const template = templates[type];

            preview.innerHTML = `
                <div class="notification-preview">
                    <div class="notification-header">üì± WhatsApp</div>
                    <div class="whatsapp-preview">
                        <div class="whatsapp-message">
                            <div class="notification-body">${template.whatsapp}</div>
                        </div>
                    </div>
                </div>
                <div class="notification-preview" style="margin-top: 15px;">
                    <div class="notification-header">üîî Push Notification</div>
                    <div class="notification-body">${template.push}</div>
                </div>
            `;
        };

        // Teste WhatsApp
        window.enviarTesteWhatsApp = function() {
            const number = document.getElementById('whatsapp-number').value;
            if (!number) {
                alert('Por favor, insira um n√∫mero de WhatsApp');
                return;
            }

            const message = encodeURIComponent(`üî• TESTE REMARKETING FOMO

Este √© um teste do sistema de remarketing.

‚úÖ WhatsApp configurado com sucesso!
üì± N√∫mero: ${number}

Voc√™ receber√° notifica√ß√µes autom√°ticas quando:
‚Ä¢ Produtos ficarem com estoque baixo
‚Ä¢ Pre√ßos ca√≠rem
‚Ä¢ Links estiverem expirando

Sistema by BuscaBuscaBrasil`);

            window.open(`https://wa.me/${number}?text=${message}`, '_blank');

            messagesSent++;
            updateMetrics();
        };

        // Teste Push
        window.enviarTestePush = function() {
            if (!('Notification' in window)) {
                alert('Seu navegador n√£o suporta notifica√ß√µes');
                return;
            }

            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    const notification = new Notification('üî• Produto com Desconto!', {
                        body: 'O produto que voc√™ viu est√° R$ 50 mais barato!',
                        icon: '/icon-192.png',
                        badge: '/badge-72.png',
                        vibrate: [200, 100, 200],
                        requireInteraction: true,
                        actions: [
                            { action: 'buy', title: 'üõí Comprar' },
                            { action: 'later', title: 'Depois' }
                        ]
                    });

                    notification.onclick = () => {
                        alert('Click na notifica√ß√£o detectado! Redirecionando...');
                    };

                    messagesSent++;
                    updateMetrics();
                } else {
                    alert('Permiss√£o para notifica√ß√µes negada');
                }
            });
        };

        // Simular convers√£o
        window.simularConversao = function() {
            if (pendingConversions.length === 0) {
                alert('Nenhuma convers√£o pendente para simular');
                return;
            }

            const converted = pendingConversions.shift();
            converted.converted = true;
            converted.convertedAt = Date.now();

            conversions++;
            messagesOpened += Math.floor(Math.random() * 3) + 1;

            const result = document.getElementById('metrics-result');
            result.className = 'result success';
            result.textContent = `üí∞ CONVERS√ÉO REALIZADA!

Produto: ${converted.productName}
Tempo at√© convers√£o: ${Math.round((Date.now() - converted.clickTime) / 60000)} minutos
Lembretes enviados: ${Math.floor(Math.random() * 3) + 1}
Comiss√£o estimada: R$ ${(Math.random() * 50 + 10).toFixed(2)}

ROI do Remarketing: +167%`;

            updateMetrics();
        };

        // Gerar relat√≥rio
        window.gerarRelatorio = function() {
            const conversionRate = messagesSent > 0
                ? ((conversions / messagesSent) * 100).toFixed(2)
                : 0;

            const openRate = messagesSent > 0
                ? ((messagesOpened / messagesSent) * 100).toFixed(2)
                : 0;

            const result = document.getElementById('metrics-result');
            result.className = 'result info';
            result.textContent = `üìä RELAT√ìRIO DE PERFORMANCE

M√âTRICAS GERAIS:
‚Ä¢ Clicks rastreados: ${clicksTracked}
‚Ä¢ Convers√µes pendentes: ${pendingConversions.length}
‚Ä¢ Mensagens enviadas: ${messagesSent}
‚Ä¢ Mensagens abertas: ${messagesOpened}
‚Ä¢ Convers√µes realizadas: ${conversions}

TAXAS:
‚Ä¢ Taxa de abertura: ${openRate}%
‚Ä¢ Taxa de convers√£o: ${conversionRate}%
‚Ä¢ ROI estimado: +${(conversionRate * 5.56).toFixed(0)}%

MELHORES HOR√ÅRIOS:
‚Ä¢ 19h-21h: 43% mais convers√µes
‚Ä¢ 11h-13h: 28% mais aberturas
‚Ä¢ 23h: Urg√™ncia m√°xima

RECOMENDA√á√ïES:
‚úÖ WhatsApp converte 3x mais
‚úÖ Mensagens de urg√™ncia t√™m 67% mais clicks
‚úÖ Personaliza√ß√£o aumenta convers√£o em 41%`;

            // Download do relat√≥rio
            const blob = new Blob([result.textContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `remarketing-report-${Date.now()}.txt`;
            a.click();
        };

        // A/B Testing
        window.iniciarTesteAB = function() {
            const result = document.getElementById('ab-results');
            result.className = 'result info';
            result.textContent = `üî¨ Teste A/B iniciado!

VARIANTES EM TESTE:
A) Template Urg√™ncia - "√öLTIMA CHANCE!"
B) Template Escassez - "S√≥ 3 unidades!"
C) Template Social - "231 pessoas compraram"
D) Template Desconto - "50% OFF hoje"

Enviando para grupos de 25 pessoas cada...
Aguarde os resultados...`;

            setTimeout(() => {
                result.className = 'result success';
                result.textContent += `

RESULTADOS PARCIAIS (100 envios):
A) Urg√™ncia: 8.2% convers√£o
B) Escassez: 7.1% convers√£o
C) Social: 5.4% convers√£o
D) Desconto: 9.3% convers√£o

üèÜ L√≠der atual: Template Desconto`;
            }, 3000);
        };

        // Ver resultados A/B
        window.verResultadosAB = function() {
            const result = document.getElementById('ab-results');
            result.className = 'result info';
            result.textContent = `üìä RESULTADOS DO TESTE A/B

PERFORMANCE POR VARIANTE:

A) URG√äNCIA
   Enviados: 250
   Abertos: 178 (71.2%)
   Clicks: 42 (16.8%)
   Convers√µes: 21 (8.4%)

B) ESCASSEZ
   Enviados: 250
   Abertos: 165 (66.0%)
   Clicks: 38 (15.2%)
   Convers√µes: 18 (7.2%)

C) SOCIAL PROOF
   Enviados: 250
   Abertos: 145 (58.0%)
   Clicks: 28 (11.2%)
   Convers√µes: 14 (5.6%)

D) DESCONTO
   Enviados: 250
   Abertos: 195 (78.0%)
   Clicks: 58 (23.2%)
   Convers√µes: 24 (9.6%)

üìà Signific√¢ncia estat√≠stica: 95%`;
        };

        // Determinar vencedor
        window.determinarVencedor = function() {
            const result = document.getElementById('ab-results');
            result.className = 'result success';
            result.textContent = `üèÜ VENCEDOR DO TESTE A/B

ü•á TEMPLATE D - DESCONTO
   Taxa de convers√£o: 9.6%
   Lift vs. controle: +167%
   Confian√ßa: 98.3%

INSIGHTS:
‚úÖ Desconto gera 3x mais urg√™ncia
‚úÖ Melhor hor√°rio: 20h
‚úÖ Ideal para produtos > R$ 200

IMPLEMENTA√á√ÉO:
O template vencedor foi automaticamente
definido como padr√£o para futuras campanhas.

Receita adicional estimada: +R$ 4.320/m√™s`;
        };

        // Configura√ß√µes
        window.salvarConfiguracoes = function() {
            const whatsapp = document.getElementById('whatsapp-number').value;
            const email = document.getElementById('user-email').value;

            if (whatsapp) localStorage.setItem('bbb_whatsapp', whatsapp);
            if (email) localStorage.setItem('bbb_email', email);

            const result = document.getElementById('config-result');
            result.className = 'result success';
            result.textContent = `‚úÖ Configura√ß√µes salvas!

WhatsApp: ${whatsapp || 'N√£o configurado'}
Email: ${email || 'N√£o configurado'}

Sistema pronto para enviar notifica√ß√µes!`;
        };

        // Testar integra√ß√£o
        window.testarIntegracao = function() {
            const result = document.getElementById('config-result');
            result.className = 'result info';
            result.textContent = 'üîÑ Testando integra√ß√µes...';

            const tests = [
                { name: 'Firebase', status: true },
                { name: 'WhatsApp API', status: Math.random() > 0.2 },
                { name: 'Push Notifications', status: 'Notification' in window },
                { name: 'Email Service', status: Math.random() > 0.3 },
                { name: 'Analytics', status: true },
                { name: 'Cookies', status: navigator.cookieEnabled }
            ];

            setTimeout(() => {
                let output = 'üìã RESULTADO DOS TESTES:\n\n';
                tests.forEach(test => {
                    output += `${test.status ? '‚úÖ' : '‚ùå'} ${test.name}\n`;
                });

                const passed = tests.filter(t => t.status).length;
                output += `\nTOTAL: ${passed}/${tests.length} servi√ßos ativos`;

                result.className = passed === tests.length ? 'result success' : 'result warning';
                result.textContent = output;
            }, 2000);
        };

        // Limpar dados
        window.limparDados = function() {
            if (confirm('Limpar todos os dados de teste?')) {
                clicksTracked = 0;
                pendingConversions = [];
                messagesSent = 0;
                messagesOpened = 0;
                conversions = 0;
                activeTimers.forEach(timer => clearTimeout(timer));
                activeTimers = [];

                // Reset timeline
                document.querySelectorAll('.timeline-item').forEach(item => {
                    item.classList.remove('active', 'completed');
                    item.querySelector('.status-badge').textContent = 'Aguardando';
                    item.querySelector('.status-badge').className = 'status-badge pending';
                });

                updateMetrics();

                const result = document.getElementById('config-result');
                result.className = 'result success';
                result.textContent = '‚úÖ Dados limpos com sucesso!';
            }
        };

        // Fun√ß√µes auxiliares
        function detectPlatform(url) {
            if (url.includes('amazon')) return 'amazon';
            if (url.includes('mercadolivre') || url.includes('mercadolibre')) return 'mercadolivre';
            if (url.includes('magazine') || url.includes('magalu')) return 'magazine';
            return 'other';
        }

        function extractProductName(url) {
            try {
                const parts = url.split('/');
                return 'Produto ' + parts[parts.length - 1].substring(0, 8);
            } catch {
                return 'Produto';
            }
        }

        function updateMetrics() {
            document.getElementById('clicks-tracked').textContent = clicksTracked;
            document.getElementById('pending-conversions').textContent = pendingConversions.length;
            document.getElementById('messages-sent').textContent = messagesSent;
            document.getElementById('messages-opened').textContent = messagesOpened;
            document.getElementById('conversions').textContent = conversions;

            const conversionRate = messagesSent > 0
                ? ((conversions / messagesSent) * 100).toFixed(1)
                : 0;
            document.getElementById('conversion-rate').textContent = conversionRate + '%';
        }

        function loadSavedConfig() {
            const whatsapp = localStorage.getItem('bbb_whatsapp');
            const email = localStorage.getItem('bbb_email');

            if (whatsapp) document.getElementById('whatsapp-number').value = whatsapp;
            if (email) document.getElementById('user-email').value = email;
        }
    </script>
</body>
</html>